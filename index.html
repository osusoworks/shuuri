<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修理料金案内アシスト</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; line-height: 1.6; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; text-align: center; border-radius: 10px; margin-bottom: 30px; }
        .step-trail { background: #eaf6fb; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 16px; color: #34495e; }
        .step-trail div { margin-bottom: 5px; }
        .step-counter { font-size: 18px; margin-bottom: 10px; color: #7f8c8d; }
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .question { font-size: 20px; margin-bottom: 25px; color: #2c3e50; font-weight: bold; }
        .options { display: grid; gap: 15px; }
        .option-btn { padding: 15px 20px; border: 2px solid #3498db; background: white; color: #3498db; border-radius: 8px; cursor: pointer; transition: all 0.3s; font-size: 16px; text-align: left; }
        .option-btn:hover { background: #3498db; color: white; }
        .option-btn.selected { background: #3498db; color: white; }
        .checkbox-group { display: grid; gap: 12px; margin: 20px 0; }
        .checkbox-item { display: flex; align-items: center; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; }
        .checkbox-item input[type="checkbox"] { margin-right: 12px; transform: scale(1.2); }
        .navigation { display: flex; gap: 15px; margin-top: 30px; }
        .nav-btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .btn-back { background: #95a5a6; color: white; }
        .btn-next { background: #27ae60; color: white; flex: 1; }
        .btn-reset { background: #e74c3c; color: white; }
        .result { background: #ecf0f1; padding: 25px; border-radius: 10px; margin: 20px 0; }
        .price-display { font-size: 24px; color: #2c3e50; font-weight: bold; margin: 15px 0; }
        .note { color: #7f8c8d; font-size: 14px; margin-top: 15px; }
        .polish-note { font-size: 12px; color: #555; margin-top: 10px; }
        .hidden { display: none; }
        @media (max-width: 768px) { .container { padding: 10px; } .card { padding: 20px; } .option-btn { font-size: 14px; padding: 12px 15px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>修理料金案内アシスト</h1>
        </div>

        <div id="step-trail" class="step-trail"></div>

        <div id="step-container" class="card">
            <div class="step-counter" id="step-counter"></div>
            <div class="question" id="question"></div>
            <div class="options" id="options"></div>
            <div class="navigation">
                <button class="nav-btn btn-back hidden" id="back-btn" onclick="goBack()">戻る</button>
                <button class="nav-btn btn-next" id="next-btn" onclick="goNext()">次へ</button>
                <button class="nav-btn btn-reset" onclick="resetApp()">リセット</button>
            </div>
        </div>

        <div id="result-container" class="card hidden">
            <h2>修理料金計算結果</h2>
            <div id="result-content"></div>
            <div class="navigation">
                <button class="nav-btn btn-reset" onclick="resetApp()">新規計算</button>
            </div>
        </div>
    </div>

    <script>
        const priceData = {
            "国産時計": {
                "SEIKO（一般）": { quartz3: 11000, quartzChrono: 15400, mechanical3: 15400, mechanicalChrono: 17600 },
                "SEIKO（DOLCE/EXCELINE/LASSALE）": { quartz3: 15400, quartzChrono: 16500, mechanical3: 17600, mechanicalChrono: 19800 },
                "SEIKO（GS/CREDOR）": { quartz3: 33000, quartzChrono: 38500, mechanical3: 44000, mechanicalChrono: 48400 },
                "CITIZEN（一般）": { quartz3: 11000, quartzChrono: 15400, mechanical3: 15400, mechanicalChrono: 17600 },
                "CITIZEN（EXCEED）": { quartz3: 15400, quartzChrono: 16500, mechanical3: 17600, mechanicalChrono: 19800 },
                "CASIO": { quartz3: 11000, quartzChrono: 15400, mechanical3: 15400, mechanicalChrono: 17600 },
                "ORIENT": { quartz3: 11000, quartzChrono: 15400, mechanical3: 15400, mechanicalChrono: 17600 },
                "EPSON": { quartz3: 11000, quartzChrono: 15400, mechanical3: 15400, mechanicalChrono: 17600 }
            },
            "舶来時計": {
                "グループ1（CYMA、ETERNA、ENICAR、FENDI、NINARICCI等）": { quartz3: 27500, quartzChrono: 33000, mechanical3: 36300, mechanicalChrono: 44000 },
                "グループ2（DIOR、DUNHILL、GUCCI、HAMILTON、LONGINES等）": { quartz3: 30800, quartzChrono: 36300, mechanical3: 39600, mechanicalChrono: 49500 },
                "グループ3（CHANEL、EBEL、HERMES、JUVENIA等）": { quartz3: 33000, quartzChrono: 58300, mechanical3: 44000, mechanicalChrono: 60500 },
                "グループ4（BREITLING、BAUME & MERCIER、CARTIER、CORUM、FRANK MULLER等）": { quartz3: 38500, quartzChrono: 60500, mechanical3: 49500, mechanicalChrono: 63800 },
                "グループ5（AUDEMARS PIGUET、CHOPARD、PATEK PHILIPPE等）": { quartz3: 66000, quartzChrono: 77000, mechanical3: 93500, mechanicalChrono: 132000 }
            },
            "TAG HEUER": {
                "フォーミュラ1": { quartz3: 27500, quartzChrono: 35200, mechanical3: 38500, mechanicalChrono: 49500 },
                "LINK/CARRERA/AQUARACER他": { quartz3: 33000, quartzChrono: 52800, mechanical3: 46200, mechanicalChrono: 60500 }
            },
            "OMEGA": {
                "DE VILLE/CONSTELLATION": { quartz3: 33000, quartzChrono: 38500, mechanical3: 49500, mechanicalChrono: 55000 },
                "SEAMASTER": { quartz3: 38500, quartzChrono: 55000, mechanical3: 60500, mechanicalChrono: 66000 },
                "SPEEDMASTER": { mechanicalChrono: 66000 }
            },
            "ROLEX": {
                "スポーツモデル（デイトナ/エクスプローラー/サブマリーナ/エアキング他）": { mechanical3: 60500, mechanicalChrono: 82500 },
                "ドレスモデル（デイトジャスト/デイデイト/オイスターパーペチュアル他）": { mechanical3: 55000 }
            }
        };

        let currentStep = 1;
        let selections = {};
        let totalSteps = 0;

        function getDynamicSteps() {
            const baseSteps = [
                {
                    question: "大分類を選択してください",
                    options: ["国産時計", "舶来時計", "TAG HEUER", "OMEGA", "ROLEX"],
                    key: "category"
                },
                {
                    question: "ブランド・グレードを選択してください",
                    getOptions: () => {
                        const category = selections.category;
                        return Object.keys(priceData[category] || {});
                    },
                    key: "brand"
                }
            ];

            // 機構選択ステップ
            const mechanismStep = {
                question: "機構を選択してください",
                getOptions: () => {
                    const category = selections.category;
                    const brand = selections.brand;
                    const brandData = priceData[category][brand];
                    
                    let options = [];
                    if (brandData.quartz3) options.push("クォーツ 3針");
                    if (brandData.quartzChrono) options.push("クォーツ クロノグラフ");
                    if (brandData.mechanical3) options.push("メカニカル 3針");
                    if (brandData.mechanicalChrono) options.push("メカニカル クロノグラフ");
                    
                    return options;
                },
                key: "mechanism"
            };

            // 特殊仕様ステップ
            const specialStep = {
                question: "特殊仕様を選択してください（該当するものにチェック）",
                type: "checkbox",
                options: [
                    { label: "シースルーバック（+2,200円）", value: "seethrough", price: 2200 },
                    { 
                        label: "OMEGA コーアクシャル（+11,000円）", 
                        value: "coaxial", 
                        price: 11000, 
                        condition: () => selections.category === "OMEGA" && selections.brand === "DE VILLE/CONSTELLATION"
                    }
                ],
                key: "special"
            };

            // 磨きステップ
            const polishStep = {
                question: "磨きオプションを選択してください（該当するものにチェック）",
                type: "checkbox",
                getOptions: () => {
                    const isRolex = selections.category === "ROLEX";
                    const price3 = isRolex ? 17600 : 16500;
                    const price5 = isRolex ? 19800 : 18700;
                    
                    return [
                        { label: `ライトポリッシュ（3連：${price3.toLocaleString()}円）`, value: "light3", price: price3 },
                        { label: `ライトポリッシュ（5連：${price5.toLocaleString()}円）`, value: "light5", price: price5 },
                        { label: `新品仕上げ（3連：${price3.toLocaleString()}円）`, value: "finish3", price: price3 },
                        { label: `新品仕上げ（5連：${price5.toLocaleString()}円）`, value: "finish5", price: price5 }
                    ];
                },
                key: "polish"
            };

            let steps = [...baseSteps, mechanismStep, specialStep];
            
            // 磨きステップはROLEXとOMEGAのみ
            if (shouldShowPolish()) {
                steps.push(polishStep);
            }
            
            return steps;
        }

        function shouldShowPolish() {
            return selections.category === "ROLEX" || selections.category === "OMEGA";
        }

        function updateStepTrail() {
            const stepTrail = document.getElementById('step-trail');
            const labels = ['大分類', 'ブランド・グレード', '機構', '特殊仕様', '磨きオプション'];
            let trailHtml = '';
            let count = 1;
            
            for (const key of ['category', 'brand', 'mechanism', 'special', 'polish']) {
                if (selections[key] && (Array.isArray(selections[key]) ? selections[key].length > 0 : true)) {
                    let val = selections[key];
                    if (Array.isArray(val)) {
                        val = val.length > 0 ? val.join(', ') : '';
                    }
                    if (val) {
                        trailHtml += `<div><strong>${count}.</strong> ${labels[count - 1]}：${val}</div>`;
                        count++;
                    }
                }
            }
            stepTrail.innerHTML = trailHtml || '<div>選択を開始してください</div>';
        }

        function renderStep() {
            const steps = getDynamicSteps();
            totalSteps = steps.length;
            
            if (currentStep > totalSteps) {
                showResult();
                return;
            }

            const step = steps[currentStep - 1];
            document.getElementById('step-counter').textContent = `ステップ ${currentStep}/${totalSteps}`;
            document.getElementById('question').textContent = step.question;
            
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            if (step.type === 'checkbox') {
                const options = step.getOptions ? step.getOptions() : step.options;
                options.forEach(option => {
                    if (option.condition && !option.condition()) return;
                    
                    const div = document.createElement('div');
                    div.className = 'checkbox-item';
                    div.innerHTML = `
                        <input type="checkbox" id="${option.value}" value="${option.value}">
                        <label for="${option.value}">${option.label}</label>
                    `;
                    optionsContainer.appendChild(div);
                });
            } else {
                const options = step.getOptions ? step.getOptions() : step.options;
                options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = option;
                    btn.onclick = () => selectOption(option);
                    if (selections[step.key] === option) {
                        btn.classList.add('selected');
                    }
                    optionsContainer.appendChild(btn);
                });
            }

            document.getElementById('back-btn').classList.toggle('hidden', currentStep === 1);
            
            const nextBtn = document.getElementById('next-btn');
            if (currentStep === totalSteps) {
                nextBtn.textContent = '計算結果を表示';
            } else {
                nextBtn.textContent = '次へ';
            }

            updateStepTrail();
        }

        function selectOption(option) {
            const steps = getDynamicSteps();
            const step = steps[currentStep - 1];
            selections[step.key] = option;
            updateStepTrail();
        }

        function goNext() {
            const steps = getDynamicSteps();
            const step = steps[currentStep - 1];
            
            if (step.type === 'checkbox') {
                const checkboxes = document.querySelectorAll('#options input[type="checkbox"]');
                selections[step.key] = Array.from(checkboxes)
                    .filter(cb => cb.checked)
                    .map(cb => cb.value);
            }

            if (currentStep === totalSteps) {
                showResult();
            } else if (selections[step.key] !== undefined) {
                currentStep++;
                renderStep();
            } else {
                alert('選択肢を選んでください');
            }
        }

        function goBack() {
            if (currentStep > 1) {
                currentStep--;
                renderStep();
            }
        }

        function showResult() {
            const category = selections.category;
            const brand = selections.brand;
            const mechanism = selections.mechanism;
            
            let mechanismKey;
            switch(mechanism) {
                case "クォーツ 3針": mechanismKey = "quartz3"; break;
                case "クォーツ クロノグラフ": mechanismKey = "quartzChrono"; break;
                case "メカニカル 3針": mechanismKey = "mechanical3"; break;
                case "メカニカル クロノグラフ": mechanismKey = "mechanicalChrono"; break;
            }

            const basePrice = priceData[category][brand][mechanismKey];
            let additionalPrice = 0;
            let polishPrice = 0;
            let additionalItems = [];

            // 特殊仕様の加算
            if (selections.special && selections.special.length > 0) {
                if (selections.special.includes('seethrough')) {
                    additionalPrice += 2200;
                    additionalItems.push('シースルーバック（+2,200円）');
                }
                if (selections.special.includes('coaxial')) {
                    additionalPrice += 11000;
                    additionalItems.push('OMEGA コーアクシャル（+11,000円）');
                }
            }

            // 磨きオプションの加算
            if (selections.polish && selections.polish.length > 0) {
                const isRolex = category === "ROLEX";
                const price3 = isRolex ? 17600 : 16500;
                const price5 = isRolex ? 19800 : 18700;
                
                selections.polish.forEach(polish => {
                    if (polish.includes('3')) {
                        polishPrice += price3;
                        additionalItems.push(`磨き3連（${price3.toLocaleString()}円）`);
                    } else if (polish.includes('5')) {
                        polishPrice += price5;
                        additionalItems.push(`磨き5連（${price5.toLocaleString()}円）`);
                    }
                });
            }

            const totalPrice = basePrice + additionalPrice + polishPrice;

            // 保証期間の判定
            let warranty = "1年";
            if (mechanismKey && mechanismKey.includes("mechanical")) {
                if (category === "国産時計" && (brand.includes("GS") || brand.includes("CREDOR") || brand.includes("EXCEED"))) {
                    warranty = "2年";
                } else if (category !== "国産時計") {
                    warranty = "2年";
                }
            }

            let resultHTML = `
                <div class="result">
                    <h3>選択内容</h3>
                    <p><strong>分類：</strong>${category}</p>
                    <p><strong>ブランド：</strong>${brand}</p>
                    <p><strong>機構：</strong>${mechanism}</p>
                    
                    <h3>料金詳細</h3>
                    <p><strong>基本料金：</strong>¥${basePrice.toLocaleString()}〜</p>
            `;

            if (additionalItems.length > 0) {
                resultHTML += `<p><strong>追加料金：</strong></p><ul>`;
                additionalItems.forEach(item => {
                    resultHTML += `<li>${item}</li>`;
                });
                resultHTML += `</ul>`;
            }

            resultHTML += `
                    <div class="price-display">
                        <strong>合計金額：¥${totalPrice.toLocaleString()}〜</strong>
                    </div>
            `;

            // 磨きセット価格表示
            if (shouldShowPolish() && polishPrice > 0) {
                resultHTML += `
                    <div class="polish-note">
                        <p>参考：磨きセット価格 = ¥${totalPrice.toLocaleString()}〜</p>
                        <p>※磨きの対応可否や詳細は修理業者判断の場合があります。</p>
                    </div>
                `;
            }

            resultHTML += `
                    <p><strong>保証期間：</strong>${warranty}</p>
                    
                    <div class="note">
                        ※料金は税込表記、開始価格です<br>
                        ※実際の修理内容により金額は変動します<br>
                        ${category === "ROLEX" ? "※ROLEX修理は磨き抜き価格となります" : ""}
                    </div>
                </div>
            `;

            document.getElementById('result-content').innerHTML = resultHTML;
            document.getElementById('step-container').classList.add('hidden');
            document.getElementById('result-container').classList.remove('hidden');
        }

        function resetApp() {
            currentStep = 1;
            selections = {};
            document.getElementById('step-container').classList.remove('hidden');
            document.getElementById('result-container').classList.add('hidden');
            renderStep();
        }

        // 初期化
        renderStep();
    </script>
</body>
</html>
